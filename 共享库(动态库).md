# 共享库(动态库)

*2020年7月8日*



1.命名规则

		- lib+库的名字+.so  如：libMine.so（下文均以此为例）

 

2.制作步骤

​		1）生成与位置无关的代码（.o文件）：gcc -fPIC -c *.c -I 头文件目录

​			换言之，Linux分给进程的地址空间（虚拟地址空间）中，生成的.o文件位置不固定

​		2）将生成的.o文件打包：gcc -shared -I 头文件目录 *.o -o libMine.so

 

3.发布动态库

​		1）发布动态库

​		2）发布头文件

 

4.使用动态库

​		1）使用的时候直接调用libMine.so和头文件的函数接口即可

​		2）使用时注意，gcc要编译新写（即用户自己写的）main函数，静态库libMine.a， 并-I 引用头文件

 

​		3）链接动态库

​		方法一：确保可执行程序(如a.out)的环境变量能够搜索到该动态库

​				[1]查看：echo $LD_LIBRARY_PATH

​				[2]若查看发现没有期望的目录，则导入：export LD_LIBRARY_PATH=期望目录（如./lib）

​				注：这种做法是临时的，常用于测试过程

​		方法二：永久设置环境变量

​				[1]cd /home/用户名

​				[2]ls -a

​				[3]vi .bashrc

​				[4]G，到最后一行

​				[5]export LD_LIBRARY_PATH=期望目录的绝对路径

​				[6]关闭终端，再次打开即可生效

​		方法三：

​				[1]找到动态连接器需要的配置文件：

​				[2]动态库的路径写到配置文件中

​				[3]更新：sudo ldconfig （如果要查看信息输出，-v）

​				[4]具体如下：

​					cd /etc

​					ls -l ld.so.conf

​					sudo vi ld.so.conf

​					o（在当前行的下面创建一行）

​					写上动态库的绝对路径

​					sudo ldconfig

​		4）常见写法

​		[1]gcc c文件 库目录里的库 -I 头文件目录	

	eg：gcc main.c lib/libMine.so -I ./head

​		[2]gcc c文件 -I 头文件目录 -L 库目录 -l 引用的库名

	> eg：gcc main.c -I ./head -L lib -l Mine

5.优缺点

| 优点                                   | 缺点                 |
| -------------------------------------- | -------------------- |
| 体积小                                 | 发布时需要提供动态库 |
| 更新后不需要更新程序（借口不变的前提） | 加载速度略慢于静态库 |