# 磁盘

*2020年6月24日*

### 磁盘管理

Linux磁盘管理好坏直接关系到整个系统的性能问题。

Linux磁盘管理常用三个命令为df、du和fdisk。

| 命令  | 用法                   | 作用                               | 参数                                                         |
| ----- | ---------------------- | ---------------------------------- | ------------------------------------------------------------ |
| df    | df [参数] [目录或文件] | 列出文件系统的<br />整体磁盘使用量 | -a 列出所有文件系统<br />-k 以KB为单位显示各文件系统<br />-m 以MB为单位显示各文件系统<br />-h  以人们较易阅读的 GBytes, MBytes, <br/>KBytes 等格式自行显示<br />-H 以 M=1000K 取代  M=1024K 的进位方式<br />-T 显示文件系统类型, 连同该 partition 的 <br />filesystem 名称 (如ext3) 也列出<br />-I 不用硬盘容量，而以 inode 的数量来显示 |
| du    | du [参数] [目录或文件] | 检查磁盘空间使用量                 | -a：列出所有的文件与目录容量，因为默认<br />仅统计目录底下的文件量而已<br />-h：以人们较易读的容量格式 (G/M)  显示<br />-s：列出总量而已，而不列出每个各别的目录<br />占用容量<br/>-S：不包括子目录下的总计，与 -s  有点差别<br />-k：以 KBytes 列出容量显示<br />-m：以 MBytes 列出容量显示 |
| fdisk | fdisk -l [装置名称]    | 用于磁盘分区                       | -l：输出后面接的装置所有的分区内容。<br />若仅有 fdisk -l 时， 则系统将会把<br/>整个系统内能够搜寻到的装置的分区均列出来 |

 

### 磁盘检验

- fsck  【-t 文件系统】【参数2】 装置名称

  -t：给定档案系统的型式，若在 /etc/fstab 中已有定义或 kernel 本身已支援的则不需加上此参数  

  参数2（可以多个一起用）：

  | 参数 | 作用                                                         |
  | ---- | ------------------------------------------------------------ |
  | -f   | 强制检查                                                     |
  | -s   | 依序一个一个地执行 fsck 的指令来检查                         |
  | -A   | 对/etc/fstab  中所有列出来的 分区（partition）做检查         |
  | -C   | 显示完整的检查进度                                           |
  | -d   | 打印出 e2fsck 的  debug 结果                                 |
  | -p   | 同时有 -A 条件时，同时有多个  fsck 的检查一起执行            |
  | -R   | 同时有 -A 条件时，省略 /  不检查                             |
  | -V   | 详细显示模式                                                 |
  | -a   | 如果检查有错则自动修复                                       |
  | -r   | 如果检查有错则由使用者回答是否修复                           |
  | -y   | 选项指定检测每个文件是自动输入yes，在不确定那些是不正常的时候，可以执行 # fsck -y 全部检查修复。 |

 

### 磁盘挂载与卸载

| 操作 | 命令                                                         | 参数                                                         |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 挂载 | mount  [文件系统] [Label名] [额外选项] [-n] 装置文件名   挂载点 |                                                              |
| 卸载 | umount  [-fn] 装置文件名或挂载点                             | -f ：强制卸除！可用在类似网络文件系统  (NFS) 无法读取到的情况下；<br /> -n ：不升级 /etc/mtab 情况下卸除 |